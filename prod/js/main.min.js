var DEBUG=!1,CURVE_POINTS=10,CURVE_POINT_X_JITTER=1.5,CURVE_POINT_Y_JITTER=3.5,CURVE_POINT_MAX_FLOAT_X_DIST=270,CURVE_POINT_MAX_FLOAT_Y_DIST=80,CURVE_POINT_MIN_FLOAT_DIST=15,CURVE_POINT_MAX_FLOAT_TIME=9e3,CURVE_POINT_MIN_FLOAT_TIME=3e3,BRUSH_COUNT=1e3,BRUSH_WIDTH=30,BRUSH_HEIGHT=450,BRUSH_MIN_SCALE_Y=.02,BRUSH_MAX_SCALE_Y_VARIANCE=.5,BRUSH_MAX_ALPHA_VARIANCE=.7,BRUSH_MAX_ANIM_TIME=7e3,BRUSH_MIN_ANIM_TIME=1500,BRUSH_MAX_Z_ANIM_TIME=8e4,BRUSH_MIN_Z_ANIM_TIME=58e3,BRUSH_ALPHA_DROPOFF=.07,MOUSE_X_OFFSET=50,MOUSE_Y_OFFSET=25,mouseXPercentage=.5,mouseYPercentage=.5;function deCasteljau(t,i,n,s,h,e,a,o,r){t+=r*(n-t),i+=r*(s-i),n+=r*(h-n),s+=r*(e-s),t+=r*(n-t),i+=r*(s-i);return{x:t+r*(n+r*(h+r*(a-h)-n)-t),y:i+r*(s+r*(e+r*(o-e)-s)-i)}}var Curve=function(t,i,n,s,d,T,c,u,M){this.vanishingPoint={x:t,y:i,z:n},this.endPoint={x:s,y:d,z:T},this.brushCount=c||BRUSH_COUNT,this.maxBrushAlpha=u||1,this.points=[new CurvePoint(this.vanishingPoint.x,this.vanishingPoint.y,this.vanishingPoint.z,0)];for(var h=0;h<CURVE_POINTS-1;h++){var e=(h+1)/CURVE_POINTS,a=(e*=e,Math.random()*CURVE_POINT_X_JITTER-CURVE_POINT_X_JITTER/2),o=this.vanishingPoint.x+e*(this.endPoint.x-this.vanishingPoint.x),a=(o+=a*(o-this.points[h].x),(1.2-e)*(Math.random()*CURVE_POINT_Y_JITTER-CURVE_POINT_Y_JITTER/2)),r=this.vanishingPoint.y+e*(this.endPoint.y-this.vanishingPoint.y),a=(r+=a*(r-this.points[h].y),e*(this.endPoint.z-this.vanishingPoint.z)+this.vanishingPoint.z);this.points.push(new CurvePoint(o,r,a,(.33*Math.random()+.33)*(o-this.points[h].x)))}this.points.push(new CurvePoint(this.endPoint.x,this.endPoint.y,this.endPoint.z,0)),this.brushes=[];for(h=0;h<this.brushCount;h++){var _=Math.random()<.01;this.brushes.push(new Brush(this,h/this.brushCount*(this.endPoint.z-this.vanishingPoint.z)+this.vanishingPoint.z,_?"rgb(200, 200, 220)":M||null,_))}},CurvePoint=(Curve.prototype={drawDebug:function(t){t.lineWidth=2,t.setLineDash([2,2]),t.strokeStyle="#f99";for(var i=1,n=this.points.length;i<n;i++){t.beginPath();var s=this.points[i].getCps();t.moveTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y),t.stroke()}for(var h=[],i=0,n=this.points.length;i<n;i++){s=this.points[i].getCps();0!==i&&h.push(s[0]),h.push(this.points[i]),i!==n-1&&h.push(s[1])}t.beginPath(),t.setLineDash([]),t.strokeStyle="#c00",t.moveTo(h[0].x,h[0].y);for(i=1,n=h.length;i<n;i+=3)t.bezierCurveTo(h[i].x,h[i].y,h[i+1].x,h[i+1].y,h[i+2].x,h[i+2].y);t.stroke()},draw:function(t){for(var i=0,n=this.brushes.length;i<n;i++)this.brushes[i].draw(t)},getPointAtZ:function(t){if(t<=this.points[0].z)return this.points[0];if(t>=this.points[this.points.length-1].z)return console.log("over"),this.points[this.points.length-1];for(var i=0,n=this.points.length;i<n&&!(t<=this.points[i].z);i++);var s=this.points[i-1],h=s.getCps(),e=this.points[i],a=e.getCps(),o=(t-s.z)/(e.z-s.z);return deCasteljau(s.x,s.y,h[1].x,h[1].y,a[0].x,a[0].y,e.x,e.y,o)},update:function(){for(var t=0,i=this.points.length;t<i;t++)this.points[t].updatePosition();for(t=0,i=this.brushes.length;t<i;t++)this.brushes[t].updatePosition()},setMaxBrushAlpha:function(t){this.maxBrushAlpha=t}},function(t,i,n,s){this.x=t,this.y=i,this.z=n,this.cpLength=s,this.cpYOffset=Math.random()*s-s,this.xAnimTime=Math.random()*(CURVE_POINT_MAX_FLOAT_TIME-CURVE_POINT_MIN_FLOAT_TIME)+CURVE_POINT_MIN_FLOAT_TIME,this.xVariance=Math.max(Math.random()*this.z*CURVE_POINT_MAX_FLOAT_X_DIST,CURVE_POINT_MIN_FLOAT_DIST),this.xMin=this.x-this.xVariance/2,this.xAnimOffset=Math.random()*Math.PI,this.yAnimTime=Math.random()*(CURVE_POINT_MAX_FLOAT_TIME-CURVE_POINT_MIN_FLOAT_TIME)+CURVE_POINT_MIN_FLOAT_TIME,this.yVariance=Math.max(Math.random()*this.z*CURVE_POINT_MAX_FLOAT_Y_DIST,CURVE_POINT_MIN_FLOAT_DIST),this.yMin=this.y-this.yVariance/2,this.yAnimOffset=Math.random()*Math.PI}),Brush=(CurvePoint.prototype={getCps:function(){return[{x:this.x-this.cpLength,y:this.y-this.cpYOffset},{x:this.x+this.cpLength,y:this.y+this.cpYOffset}]},updatePosition:function(){this.startTime||(this.startTime=(new Date).getTime());var t=(new Date).getTime()-this.startTime;this.x=this.xMin+(.5*Math.sin(t/this.xAnimTime*Math.PI+this.xAnimOffset)+.5)*this.xVariance,this.x+=this.z*(1-2*mouseXPercentage)*MOUSE_X_OFFSET,this.y=this.yMin+(.5*Math.sin(t/this.yAnimTime*Math.PI+this.yAnimOffset)+.5)*this.yVariance,this.y+=this.z*(1-2*mouseYPercentage)*MOUSE_Y_OFFSET}},function(t,i,n,s){this.curve=t,this.z=i,this.alpha=i*Math.random()*.55+.15,this.scaleYMod=(1-BRUSH_MIN_SCALE_Y)*Math.random(),this.scaleXMod=.5*Math.random()*(2-2*this.scaleYMod),this.noScale=!!s,this.color1=n||"rgb(50, 170, 82)",this.alphaAnimTime=Math.random()*(BRUSH_MAX_ANIM_TIME-BRUSH_MIN_ANIM_TIME)+BRUSH_MIN_ANIM_TIME,this.alphaVariance=Math.max(Math.random()*BRUSH_MAX_ALPHA_VARIANCE,this.alpha),this.alphaMin=Math.max(this.alpha-this.alphaVariance/2,0),this.alphaAnimOffset=Math.random()*Math.PI,this.scaleYAnimTime=Math.random()*(BRUSH_MAX_ANIM_TIME-BRUSH_MIN_ANIM_TIME)+BRUSH_MIN_ANIM_TIME,this.scaleYVariance=Math.random()*BRUSH_MAX_SCALE_Y_VARIANCE,this.scaleYMin=this.scaleY-this.scaleYVariance/2,this.scaleYAnimOffset=Math.random()*Math.PI,this.zAnimOffset=this.curve.vanishingPoint.z-(i-this.curve.vanishingPoint.z),this.zAnimTime=Math.random()*(BRUSH_MAX_Z_ANIM_TIME-BRUSH_MIN_Z_ANIM_TIME)+BRUSH_MIN_Z_ANIM_TIME,this.noScale&&(this.alphaMin=0,this.alphaVariance=1)}),NorthernLights=(Brush.prototype={draw:function(t){if(this.z<this.curve.vanishingPoint.z||this.z>this.curve.endPoint.z)return!1;var i,n,s=this.curve.getPointAtZ(this.z),h=(.5+.5*Math.min(this.z,1))*this.alpha*this.curve.maxBrushAlpha;this.z-this.curve.vanishingPoint.z<BRUSH_ALPHA_DROPOFF?h*=(this.z-this.curve.vanishingPoint.z)/BRUSH_ALPHA_DROPOFF:this.curve.endPoint.z-this.z<BRUSH_ALPHA_DROPOFF&&(h*=(this.curve.endPoint.z-this.z)/BRUSH_ALPHA_DROPOFF),n=this.noScale?(i=this.scaleYMod+BRUSH_MIN_SCALE_Y,this.scaleXMod+.5):(i=this.z*this.scaleYMod+BRUSH_MIN_SCALE_Y,this.z*this.scaleXMod+.5),t.fillStyle=this.color1,t.globalAlpha=h,t.beginPath(),t.moveTo(s.x,s.y-i*BRUSH_HEIGHT),t.quadraticCurveTo(s.x+n*BRUSH_WIDTH/2,s.y-i*BRUSH_HEIGHT,s.x+n*BRUSH_WIDTH/2,s.y),t.quadraticCurveTo(s.x+n*BRUSH_WIDTH/2,s.y+i*BRUSH_WIDTH,s.x,s.y+n*BRUSH_WIDTH/2),t.quadraticCurveTo(s.x-n*BRUSH_WIDTH/2,s.y+i*BRUSH_WIDTH,s.x-n*BRUSH_WIDTH/2,s.y),t.quadraticCurveTo(s.x-n*BRUSH_WIDTH/2,s.y-i*BRUSH_HEIGHT,s.x,s.y-i*BRUSH_HEIGHT),t.fill()},updatePosition:function(){this.startTime||(this.startTime=(new Date).getTime()-2e4);var t=(new Date).getTime(),i=t-this.startTime;this.alpha=Math.min(this.alphaMin+(.5*Math.sin(i/this.alphaAnimTime*Math.PI+this.alphaAnimOffset)+.5)*this.alphaVariance,1),this.scaleY=this.scaleYMin+(.5*Math.sin(i/this.scaleYAnimTime*Math.PI+this.scaleYAnimOffset)+.5)*this.scaleYVariance,this.z=(i/this.zAnimTime+this.zAnimOffset)*this.curve.endPoint.z,this.z>this.curve.vanishingPoint.z&&(this.z*=this.z),this.z>this.curve.endPoint.z&&(this.z=this.z-this.curve.endPoint.z+this.curve.vanishingPoint.z,this.startTime=t)}},function(t,i,n,s){this.parentElement=t,this.width=i||window.innerWidth,this.height=n||window.innerHeight,this.canvas=document.getElementById("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),this.ctx.globalCompositeOperation="color-dodge",this.curves=s||[new Curve(.1*this.width,.9*this.height,.9*this.width,.4*this.height)],DEBUG&&(this.fpsDisplay=document.createElement("span"),this.fpsDisplay.style.position="fixed",this.fpsDisplay.style.top="0",this.fpsDisplay.style.left="0",this.fpsDisplay.style.background="#333",this.fpsDisplay.style.color="#0f0",document.body.appendChild(this.fpsDisplay)),this.start(),this.parentElement.appendChild(this.canvas)}),gradCanvas=(NorthernLights.prototype={start:function(){this.running=!0;var h=this,e=(new Date).getTime();!function t(){h.ctx.clearRect(0,0,h.width,h.height);for(var i,n=0,s=h.curves.length;n<s;n++)h.curves[n].update(),h.curves[n].draw(h.ctx),DEBUG&&(h.ctx.globalCompositeOperation="source-over",h.ctx.globalAlpha=1,h.curves[n].drawDebug(h.ctx),h.ctx.globalCompositeOperation="color-dodge",i=(new Date).getTime(),h.fpsDisplay.innerText=Math.round(1e3/(i-e)),e=i);h.running&&requestAnimationFrame(t)}()},pause:function(){this.running=!1},getCanvas:function(){return this.canvas},getCurves:function(){return this.curves}},document.createElement("canvas")),gradCtx=gradCanvas.getContext("2d"),grad=gradCtx.createLinearGradient(.5*window.innerWidth,window.innerHeight,.35*window.innerWidth,0),grad2=(grad.addColorStop(.4,"rgb(50, 130, 80)"),grad.addColorStop(.6,"rgba(100, 100, 120, .5)"),gradCtx.createLinearGradient(.5*window.innerWidth,.5*window.innerHeight,.3*window.innerWidth,0)),curves=(grad2.addColorStop(.35,"rgb(50, 130, 140)"),grad2.addColorStop(.7,"rgba(50, 70, 100,.7)"),[new Curve(.17*window.innerWidth,.94*window.innerHeight,.01,.8*window.innerWidth,.8*window.innerHeight,.8,.3*BRUSH_COUNT,.4,"rgb(60, 150, 120)"),new Curve(.1*window.innerWidth,.9*window.innerHeight,.05,.8*window.innerWidth,.4*window.innerHeight,1,null,.8,grad),new Curve(.25*window.innerWidth,.65*window.innerHeight,.33,.55*window.innerWidth,0,1.1,.6*BRUSH_COUNT,1,grad2)]),nl1=new NorthernLights(document.body,null,null,curves);document.body.addEventListener("mousemove",function(t){mouseXPercentage=t.clientX/window.innerWidth,mouseYPercentage=t.clientY/window.innerHeight});